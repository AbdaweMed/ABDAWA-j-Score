<!doctype html>
<html lang="fr">
<head>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <meta charset="utf-8">
  <title>ABDAWA J‑Score – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{ padding:2rem; background:#f8fafc; font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .brand{ font-weight:800; background:linear-gradient(90deg,#4f46e5,#06b6d4); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .mono { font-family: ui-monospace, Menlo, monospace; }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex align-items-center mb-3" style="gap:12px">
      <img class="ABDAWA-logo" alt="logo" width="40" height="40" src="{{ url_for('static', filename='logo_abdawa.png') }}" />
      <h1 class="mb-0 brand">ABDAWA J‑Score – Admin <small class="text-muted" style="font-size:.6em">{{ version }}</small></h1>
    </div>
    <h1 class="mb-1 brand">ABDAWA J‑Score – Admin <small class="text-muted" style="font-size:.6em">{{ version }}</small></h1>
    <p class="text-muted">Gestion des soumissions</p>
    <form class="row g-2 mb-3" method="get" action="{{ url_for('admin_list') }}">
      <div class="col-sm-8 col-md-6">
        <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Filtrer par ID patient ou diagnostic…">
      </div>
      <div class="col-auto"><button class="btn btn-primary">Rechercher</button></div>
      <div class="col-auto"><a class="btn btn-outline-secondary" href="{{ url_for('export_csv') }}">Exporter CSV</a></div>
    </form>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-light"><tr><th>ID</th><th>Horodatage (UTC)</th><th>Patient</th><th>J‑score</th><th>Interprétation</th><th>Photo</th><th>PDF</th><th>Imprimer</th><th>JSON</th><th>Action</th></tr></thead>
        <tbody>
        {% for id, ts, pid, score, interp, photo in rows %}
          <tr>
            <td class="mono">{{ id }}</td>
            <td class="mono">{{ ts }}</td>
            <td class="mono">{{ pid }}</td>
            <td class="mono">{{ score if score is not none else '—' }}</td>
            <td>{{ interp or '—' }}</td>
            <td>{% if photo %}<a href="{{ url_for('serve_upload', filename=photo) }}" target="_blank">Voir</a>{% else %}—{% endif %}</td>
            <td>{% set pdf_file = "submission_" ~ id ~ ".pdf" %}                <a href="{{ url_for('serve_pdf', filename=pdf_file) }}" target="_blank">Ouvrir</a>            </td>
            <td><a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin_print', sub_id=id) }}" target="_blank">Imprimer</a></td>
            <td><a href="{{ url_for('admin_detail_json', sub_id=id) }}" target="_blank">JSON</a></td>
            <td>
              <a class="btn btn-sm btn-outline-danger" href="{{ url_for('admin_delete', sub_id=id) }}?confirm=1">Supprimer</a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <p class="text-muted small mt-3">Protection par Basic Auth (Authorization: Basic …). Identifiants via variables d’environnement <code>ADMIN_USER</code>/<code>ADMIN_PASS</code>.</p>
  </div>
</body>
</html>
